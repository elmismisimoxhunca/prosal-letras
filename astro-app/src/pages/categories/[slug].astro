---
import { getTags, getPostsByTag } from '../../lib/ghost';
import Layout from '../../layouts/Layout.astro';
import PostCard from '../../components/PostCard.astro';

export async function getStaticPaths() {
  const tags = await getTags();
  return tags.map((tag) => ({
    params: { slug: tag.slug },
    props: { tag },
  }));
}

const { slug } = Astro.params;
const tags = await getTags();
const tag = tags.find((t) => t.slug === slug);
const posts = await getPostsByTag(slug!);

if (!tag) {
  return Astro.redirect('/');
}
---

<Layout title={`${tag.name} - Articles`}>
  <main>
    <section class="category-header">
      <h1>{tag.name}</h1>
      {tag.description && <p class="description">{tag.description}</p>}
      <p class="post-count">{posts.length} article{posts.length !== 1 ? 's' : ''}</p>
    </section>

    <section class="posts-grid">
      {posts.length > 0 ? (
        <div class="grid">
          {posts.map((post) => (
            <PostCard post={post} />
          ))}
        </div>
      ) : (
        <p>No articles in this category yet.</p>
      )}
    </section>

    <nav class="back-link">
      <a href="/">‚Üê Back to Blog</a>
    </nav>
  </main>
</Layout>

<style>
  main {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
  }

  .category-header {
    text-align: center;
    margin-bottom: 3rem;
    padding: 2rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 8px;
  }

  .category-header h1 {
    font-size: 2.5rem;
    margin: 0 0 0.5rem 0;
  }

  .description {
    font-size: 1.1rem;
    margin: 0.5rem 0;
    opacity: 0.95;
  }

  .post-count {
    font-size: 0.95rem;
    margin: 0.5rem 0 0 0;
    opacity: 0.9;
  }

  .posts-grid {
    margin-bottom: 2rem;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
  }

  .back-link {
    text-align: center;
  }

  .back-link a {
    color: #667eea;
    text-decoration: none;
    font-weight: 500;
  }

  .back-link a:hover {
    text-decoration: underline;
  }
</style>
